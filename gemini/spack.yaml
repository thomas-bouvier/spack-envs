spack:
  config:
    install_tree: /mnt/spack
    build_stage: /tmp/spack-stage
  repos:
  - /root/spack-packages
  - /root/mochi-spack-packages
  packages:
    magma:
      variants: [+cuda cuda_arch=70]
    nccl:
      variants: [+cuda cuda_arch=70]
    nccl-tests:
      variants: [+cuda cuda_arch=70]
    py-horovod:
      variants: [+cuda cuda_arch=70 tensor_ops=nccl]
    py-torch:
      variants: [+cuda cuda_arch=70 +nccl +cudnn +magma +distributed]
    # IB/Verbs using a system-provided rdma-core/OFED library ##########
    mercury:
       variants: ~boostsys ~checksum +ofi
    rdma-core:
      externals:
      - spec: rdma-core@41.0
        prefix: /usr
  specs:
  # Precedence is important. These packages will be picked up in the mochi repo.
  - mochi-thallium ^argobots ^mercury +boostsys +ofi +debug ^libfabric +cuda +gdrcopy +debug fabrics=tcp,rxm,verbs
  - cuda@11.8
  - cudnn@8.4.0
  - openmpi@4.1.2
  - nccl@2.11.4-1 # https://github.com/horovod/horovod/issues/3831
  - nccl-tests
  - python@3.10
  - nvtx +python
  - py-pip
  - py-pybind11
  - py-ruamel-yaml
  - py-filelock
  - py-wandb
  - py-continuum
  - py-timm
  - tbouvier.py-nvidia-dali@1.27.0-dev-cuda110
  - py-torch@2.0.1 ~gloo
  - py-torchsummary
  - py-bokeh
  - py-matplotlib
  - py-horovod@0.28.0 controllers=mpi frameworks=pytorch
  concretizer:
    unify: true
  view: /mnt/view/gemini
